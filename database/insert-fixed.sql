-- 运行说明：
-- 1) 请先执行 init.sql 创建表与约束；
-- 2) 本脚本包含事务与清理，可重复执行；
-- 3) 如遇错误会自动回滚，不会留下半成品数据。

SET XACT_ABORT ON;
BEGIN TRANSACTION;

-- 为了重复运行脚本时保持一致，先清空依赖顺序的业务表（按外键依赖顺序）
IF OBJECT_ID(N'PaymentMethod', N'U') IS NOT NULL DELETE FROM PaymentMethod;
IF OBJECT_ID(N'PointRecord', N'U') IS NOT NULL DELETE FROM PointRecord;
IF OBJECT_ID(N'OrderDetail', N'U') IS NOT NULL DELETE FROM OrderDetail;
IF OBJECT_ID(N'[Order]', N'U') IS NOT NULL DELETE FROM [Order];

-- 1. 插入学生数据 (50条记录) - 修复SEX约束问题
INSERT INTO Student
    (StudentID, Name, SEX, Major, Balance, Points)
VALUES
    (1001, N'张三', N'M', N'计算机科学与技术', 158.50, 1250),
    (1002, N'李四', N'F', N'软件工程', 89.20, 680),
    (1003, N'王五', N'M', N'电子信息工程', 234.80, 1890),
    (1004, N'赵六', N'F', N'通信工程', 67.30, 420),
    (1005, N'钱七', N'M', N'自动化', 456.70, 3200),
    (1006, N'孙八', N'F', N'机械工程', 123.40, 980),
    (1007, N'周九', N'M', N'材料科学与工程', 78.90, 610),
    (1008, N'吴十', N'F', N'化学工程与工艺', 189.60, 1450),
    (1009, N'郑十一', N'M', N'生物工程', 267.80, 2100),
    (1010, N'陈十二', N'F', N'环境工程', 145.20, 1120),
    (1011, N'林明', N'M', N'土木工程', 98.50, 750),
    (1012, N'黄丽', N'F', N'建筑学', 178.30, 1380),
    (1013, N'刘强', N'M', N'水利工程', 234.60, 1890),
    (1014, N'张敏', N'F', N'电气工程', 156.80, 1230),
    (1015, N'王华', N'M', N'控制科学与工程', 89.40, 690),
    (1016, N'李娜', N'F', N'计算机科学与技术', 312.70, 2450),
    (1017, N'赵伟', N'M', N'软件工程', 67.90, 520),
    (1018, N'孙芳', N'F', N'数据科学与大数据技术', 198.50, 1560),
    (1019, N'周杰', N'M', N'人工智能', 134.20, 1050),
    (1020, N'吴雪', N'F', N'物联网工程', 256.80, 2010),
    (1021, N'杨帆', N'M', N'网络空间安全', 89.60, 710),
    (1022, N'徐静', N'F', N'数学与应用数学', 167.40, 1320),
    (1023, N'朱军', N'M', N'应用物理学', 234.10, 1850),
    (1024, N'马琳', N'F', N'应用化学', 145.70, 1140),
    (1025, N'胡涛', N'M', N'生物技术', 78.30, 610),
    (1026, N'郭艳', N'F', N'统计学', 289.50, 2270),
    (1027, N'何平', N'M', N'经济学', 156.20, 1230),
    (1028, N'高兰', N'F', N'金融学', 345.80, 2720),
    (1029, N'罗勇', N'M', N'国际经济与贸易', 98.70, 770),
    (1030, N'梁敏', N'F', N'法学', 189.40, 1490),
    (1031, N'谢军', N'M', N'政治学与行政学', 234.90, 1860),
    (1032, N'唐丽', N'F', N'社会学', 67.50, 520),
    (1033, N'韩强', N'M', N'汉语言文学', 145.30, 1140),
    (1034, N'冯芳', N'F', N'英语', 178.60, 1410),
    (1035, N'于华', N'M', N'日语', 89.80, 700),
    (1036, N'董娜', N'F', N'新闻学', 256.40, 2020),
    (1037, N'袁伟', N'M', N'广告学', 123.70, 970),
    (1038, N'范静', N'F', N'历史学', 198.20, 1560),
    (1039, N'石磊', N'M', N'考古学', 312.90, 2460),
    (1040, N'邓雪', N'F', N'哲学', 134.50, 1060),
    (1041, N'曹明', N'M', N'心理学', 267.30, 2110),
    (1042, N'彭丽', N'F', N'教育学', 78.90, 620),
    (1043, N'肖强', N'M', N'学前教育', 189.70, 1500),
    (1044, N'田芳', N'F', N'小学教育', 145.10, 1140),
    (1045, N'段华', N'M', N'体育教育', 234.50, 1850),
    (1046, N'雷娜', N'F', N'音乐学', 98.30, 770),
    (1047, N'侯伟', N'M', N'美术学', 156.80, 1230),
    (1048, N'邵静', N'F', N'舞蹈学', 289.60, 2280),
    (1049, N'万勇', N'M', N'戏剧影视文学', 67.40, 530),
    (1050, N'史敏', N'F', N'广播电视编导', 345.20, 2720);

-- 2. 插入商家数据 (20条记录)
INSERT INTO Merchant
    (MerchantID, Name, Location, Manager)
VALUES
    (2001, N'第一食堂一楼', N'第一食堂一楼', N'张经理'),
    (2002, N'第一食堂二楼', N'第一食堂二楼', N'李经理'),
    (2003, N'第二食堂一楼', N'第二食堂一楼', N'王经理'),
    (2004, N'第二食堂二楼', N'第二食堂二楼', N'赵经理'),
    (2005, N'第三食堂', N'第三食堂', N'钱经理'),
    (2006, N'清真餐厅', N'学生活动中心一楼', N'孙经理'),
    (2007, N'教工餐厅', N'行政楼一楼', N'周经理'),
    (2008, N'西餐厅', N'国际交流中心', N'吴经理'),
    (2009, N'美食广场', N'大学生活动中心二楼', N'郑经理'),
    (2010, N'奶茶店一条街', N'商业街A区', N'陈经理'),
    (2011, N'面食馆', N'第一食堂三楼', N'林经理'),
    (2012, N'煲仔饭专门店', N'第二食堂三楼', N'黄经理'),
    (2013, N'麻辣烫', N'第三食堂二楼', N'刘经理'),
    (2014, N'烧烤店', N'北区食堂', N'张经理'),
    (2015, N'日式料理', N'留学生食堂', N'杨经理'),
    (2016, N'韩式料理', N'国际学院一楼', N'徐经理'),
    (2017, N'粤菜馆', N'教职工活动中心', N'朱经理'),
    (2018, N'川菜馆', N'南区食堂', N'马经理'),
    (2019, N'江浙菜馆', N'图书馆地下一层', N'胡经理'),
    (2020, N'素食餐厅', N'体育馆二楼', N'郭经理');

-- 3. 插入菜品数据 (153条记录)
INSERT INTO Dish
    (DishID, Name, Price, Stock, MerchantID)
VALUES
    -- 第一食堂一楼的菜品
    (3001, N'红烧肉', 18.00, 50, 2001),
    (3002, N'宫保鸡丁', 16.00, 45, 2001),
    (3003, N'麻婆豆腐', 12.00, 60, 2001),
    (3004, N'青椒肉丝', 14.00, 40, 2001),
    (3005, N'糖醋排骨', 20.00, 35, 2001),
    (3006, N'西红柿鸡蛋', 10.00, 80, 2001),
    (3007, N'炒青菜', 8.00, 100, 2001),
    (3008, N'白米饭', 2.00, 200, 2001),
    (3009, N'紫菜蛋花汤', 6.00, 150, 2001),
    (3010, N'酸梅汤', 4.00, 180, 2001),

    -- 第一食堂二楼的菜品
    (3011, N'鱼香肉丝', 15.00, 55, 2002),
    (3012, N'回锅肉', 17.00, 42, 2002),
    (3013, N'水煮鱼', 22.00, 30, 2002),
    (3014, N'干煸豆角', 11.00, 70, 2002),
    (3015, N'蒜蓉生菜', 9.00, 90, 2002),
    (3016, N'蒸蛋羹', 8.00, 85, 2002),
    (3017, N'小笼包', 12.00, 60, 2002),
    (3018, N'豆浆', 3.00, 160, 2002),
    (3019, N'油条', 2.50, 140, 2002),
    (3020, N'咸菜', 1.00, 200, 2002),

    -- 第二食堂一楼的菜品
    (3021, N'黄焖鸡米饭', 18.00, 48, 2003),
    (3022, N'咖喱鸡饭', 16.00, 52, 2003),
    (3023, N'黑椒牛柳饭', 20.00, 38, 2003),
    (3024, N'扬州炒饭', 14.00, 65, 2003),
    (3025, N'蛋炒饭', 10.00, 90, 2003),
    (3026, N'虾仁滑蛋饭', 19.00, 35, 2003),
    (3027, N'叉烧饭', 17.00, 45, 2003),
    (3028, N'云吞面', 13.00, 70, 2003),
    (3029, N'牛肉面', 15.00, 55, 2003),
    (3030, N'西红柿鸡蛋面', 11.00, 80, 2003),

    -- 第二食堂二楼的菜品
    (3031, N'麻辣香锅', 25.00, 40, 2004),
    (3032, N'火锅', 30.00, 25, 2004),
    (3033, N'烤鱼', 28.00, 30, 2004),
    (3034, N'小龙虾', 35.00, 20, 2004),
    (3035, N'毛血旺', 22.00, 35, 2004),
    (3036, N'口水鸡', 18.00, 50, 2004),
    (3037, N'夫妻肺片', 16.00, 45, 2004),
    (3038, N'担担面', 12.00, 75, 2004),
    (3039, N'钟水饺', 10.00, 85, 2004),
    (3040, N'龙抄手', 11.00, 80, 2004),

    -- 第三食堂的菜品
    (3041, N'红烧狮子头', 16.00, 42, 2005),
    (3042, N'糖醋里脊', 15.00, 48, 2005),
    (3043, N'白切鸡', 18.00, 38, 2005),
    (3044, N'蒜蓉粉丝蒸扇贝', 22.00, 30, 2005),
    (3045, N'清蒸鲈鱼', 26.00, 25, 2005),
    (3046, N'蚝油生菜', 8.00, 95, 2005),
    (3047, N'白灼虾', 24.00, 35, 2005),
    (3048, N'腊味合蒸', 20.00, 40, 2005),
    (3049, N'煲仔饭', 14.00, 60, 2005),
    (3050, N'老火靓汤', 12.00, 70, 2005),

    -- 清真餐厅的菜品
    (3051, N'大盘鸡', 22.00, 35, 2006),
    (3052, N'羊肉泡馍', 18.00, 45, 2006),
    (3053, N'手抓饭', 16.00, 50, 2006),
    (3054, N'烤羊肉串', 3.00, 300, 2006),
    (3055, N'馕', 2.00, 200, 2006),
    (3056, N'拉条子', 12.00, 80, 2006),
    (3057, N'烤包子', 4.00, 150, 2006),
    (3058, N'酸奶', 6.00, 120, 2006),
    (3059, N'奶茶', 8.00, 100, 2006),
    (3060, N'抓饭', 15.00, 55, 2006),

    -- 西餐厅的菜品
    (3061, N'牛排', 45.00, 30, 2008),
    (3062, N'意大利面', 28.00, 40, 2008),
    (3063, N'披萨', 32.00, 35, 2008),
    (3064, N'沙拉', 18.00, 60, 2008),
    (3065, N'三明治', 15.00, 70, 2008),
    (3066, N'汉堡', 20.00, 50, 2008),
    (3067, N'薯条', 12.00, 100, 2008),
    (3068, N'炸鸡', 18.00, 65, 2008),
    (3069, N'咖啡', 15.00, 120, 2008),
    (3070, N'果汁', 10.00, 150, 2008),

    -- 美食广场的菜品
    (3071, N'章鱼小丸子', 12.00, 80, 2009),
    (3072, N'烤冷面', 10.00, 90, 2009),
    (3073, N'臭豆腐', 8.00, 100, 2009),
    (3074, N'铁板鱿鱼', 15.00, 70, 2009),
    (3075, N'炸鸡排', 14.00, 85, 2009),
    (3076, N'鸡柳', 12.00, 95, 2009),
    (3077, N'烤肠', 6.00, 180, 2009),
    (3078, N'玉米汁', 8.00, 140, 2009),
    (3079, N'甘蔗汁', 7.00, 160, 2009),
    (3080, N'珍珠奶茶', 12.00, 110, 2009),

    -- 奶茶店的饮品
    (3081, N'原味奶茶', 10.00, 200, 2010),
    (3082, N'珍珠奶茶', 12.00, 180, 2010),
    (3083, N'椰果奶茶', 12.00, 170, 2010),
    (3084, N'红豆奶茶', 13.00, 150, 2010),
    (3085, N'芒果奶茶', 14.00, 140, 2010),
    (3086, N'草莓奶茶', 14.00, 130, 2010),
    (3087, N'绿茶', 8.00, 220, 2010),
    (3088, N'红茶', 8.00, 210, 2010),
    (3089, N'乌龙茶', 9.00, 190, 2010),
    (3090, N'普洱茶', 10.00, 160, 2010),

    -- 面食馆的面条
    (3091, N'兰州拉面', 13.00, 120, 2011),
    (3092, N'刀削面', 12.00, 130, 2011),
    (3093, N'炸酱面', 14.00, 110, 2011),
    (3094, N'热干面', 11.00, 140, 2011),
    (3095, N'重庆小面', 12.00, 125, 2011),
    (3096, N'宜宾燃面', 13.00, 115, 2011),
    (3097, N'担担面', 12.00, 120, 2011),
    (3098, N'红油抄手', 10.00, 150, 2011),
    (3099, N'钟水饺', 11.00, 140, 2011),
    (3100, N'赖汤圆', 8.00, 180, 2011),

    -- 煲仔饭专门店
    (3101, N'腊味煲仔饭', 16.00, 60, 2012),
    (3102, N'香菇滑鸡煲仔饭', 15.00, 65, 2012),
    (3103, N'排骨煲仔饭', 18.00, 55, 2012),
    (3104, N'牛肉煲仔饭', 19.00, 50, 2012),
    (3105, N'叉烧煲仔饭', 17.00, 58, 2012),

    -- 麻辣烫
    (3106, N'麻辣烫套餐', 20.00, 80, 2013),
    (3107, N'素食麻辣烫', 15.00, 90, 2013),
    (3108, N'蔬菜麻辣烫', 25.00, 70, 2013),

    -- 烧烤店
    (3109, N'烤鸡翅', 8.00, 150, 2014),
    (3110, N'烤羊肉串', 3.00, 400, 2014),
    (3111, N'烤牛肉串', 4.00, 350, 2014),
    (3112, N'烤茄子', 6.00, 200, 2014),
    (3113, N'烤玉米', 5.00, 180, 2014),

    -- 日式料理
    (3114, N'寿司拼盘', 28.00, 40, 2015),
    (3115, N'天妇罗', 22.00, 50, 2015),
    (3116, N'照烧鸡腿饭', 18.00, 60, 2015),
    (3117, N'味噌拉面', 16.00, 70, 2015),
    (3118, N'章鱼烧', 14.00, 80, 2015),

    -- 韩式料理
    (3119, N'石锅拌饭', 20.00, 55, 2016),
    (3120, N'韩式烤肉', 35.00, 30, 2016),
    (3121, N'泡菜炒饭', 16.00, 65, 2016),
    (3122, N'韩式炸鸡', 24.00, 45, 2016),
    (3123, N'部队火锅', 28.00, 35, 2016),

    -- 粤菜馆
    (3124, N'广式早茶套餐', 25.00, 40, 2017),
    (3125, N'虾饺', 15.00, 80, 2017),
    (3126, N'烧卖', 12.00, 90, 2017),
    (3127, N'叉烧包', 10.00, 100, 2017),
    (3128, N'流沙包', 12.00, 85, 2017),

    -- 川菜馆
    (3129, N'麻婆豆腐', 12.00, 110, 2018),
    (3130, N'水煮牛肉', 24.00, 45, 2018),
    (3131, N'辣子鸡', 22.00, 50, 2018),
    (3132, N'酸菜鱼', 26.00, 40, 2018),
    (3133, N'回锅肉', 18.00, 60, 2018),

    -- 江浙菜馆
    (3134, N'西湖醋鱼', 28.00, 35, 2019),
    (3135, N'东坡肉', 20.00, 50, 2019),
    (3136, N'龙井虾仁', 32.00, 30, 2019),
    (3137, N'叫花鸡', 35.00, 25, 2019),
    (3138, N'糖醋排骨', 18.00, 65, 2019),

    -- 素食餐厅
    (3139, N'素炒时蔬', 12.00, 100, 2020),
    (3140, N'麻婆豆腐（素）', 10.00, 120, 2020),
    (3141, N'素宫保鸡丁', 14.00, 90, 2020),
    (3142, N'素食火锅', 22.00, 50, 2020),
    (3143, N'素斋套餐', 18.00, 70, 2020),

    -- 继续生成更多菜品以达到153条
    (3144, N'宫保鸡丁', 16.00, 85, 2001),
    (3145, N'鱼香茄子', 13.00, 95, 2001),
    (3146, N'地三鲜', 11.00, 105, 2001),
    (3147, N'京酱肉丝', 15.00, 75, 2001),
    (3148, N'锅包肉', 17.00, 65, 2001),
    (3149, N'小酥肉', 14.00, 80, 2001),
    (3150, N'口水鸡', 16.00, 70, 2001),
    (3151, N'夫妻肺片', 18.00, 60, 2001),
    (3152, N'红油耳片', 15.00, 75, 2001),
    (3153, N'蒜泥白肉', 14.00, 85, 2001);

-- =============================================
-- 规范化与约束一致性处理（根据 init.sql 表结构）
-- 1) 校准订单总额为订单详情小计之和
-- 2) 为已完成/已取餐/已支付的订单补齐支付记录（若不存在）
-- 3) 为已完成/已取餐/已支付的订单补齐积分记录（若不存在）
-- =============================================
-- 规范化步骤移至脚本末尾，在插入所有数据完成后执行

-- 4. 插入订单数据 (50条记录) - 修复Status约束问题
INSERT INTO [Order]
    (OrderID, StudentID, MerchantID, OrderTime, TotalAmount, Status)
VALUES
    -- 2024年10月的订单
    (202410001, 1001, 2001, '2024-10-28 07:30:00', 22.00, N'已完成'),
    (202410002, 1002, 2003, '2024-10-28 08:15:00', 19.50, N'已完成'),
    (202410003, 1003, 2005, '2024-10-28 12:00:00', 35.80, N'已取餐'),
    (202410004, 1004, 2008, '2024-10-28 12:30:00', 48.00, N'已完成'),
    (202410005, 1005, 2010, '2024-10-28 14:20:00', 12.00, N'已完成'),
    (202410006, 1006, 2001, '2024-10-28 18:00:00', 26.50, N'已完成'),
    (202410007, 1007, 2004, '2024-10-28 18:45:00', 42.00, N'已取餐'),
    (202410008, 1008, 2009, '2024-10-28 19:30:00', 18.00, N'已完成'),
    (202410009, 1009, 2013, '2024-10-28 20:15:00', 24.00, N'已完成'),
    (202410010, 1010, 2002, '2024-10-29 07:45:00', 15.80, N'已完成'),

    -- 继续10月订单
    (202410011, 1011, 2001, '2024-10-29 08:00:00', 20.00, N'已完成'),
    (202410012, 1012, 2003, '2024-10-29 11:45:00', 17.50, N'已完成'),
    (202410013, 1013, 2006, '2024-10-29 12:15:00', 28.00, N'已完成'),
    (202410014, 1014, 2008, '2024-10-29 12:45:00', 52.00, N'已取餐'),
    (202410015, 1015, 2010, '2024-10-29 15:30:00', 14.00, N'已完成'),
    (202410016, 1016, 2001, '2024-10-29 17:45:00', 32.50, N'已完成'),
    (202410017, 1017, 2004, '2024-10-29 18:30:00', 38.00, N'已完成'),
    (202410018, 1018, 2009, '2024-10-29 19:00:00', 22.00, N'已完成'),
    (202410019, 1019, 2011, '2024-10-29 19:45:00', 16.00, N'已取餐'),
    (202410020, 1020, 2002, '2024-10-30 07:30:00', 18.50, N'已完成'),

    -- 11月订单（增加更多订单状态变化）
    (202411001, 1021, 2001, '2024-11-01 07:15:00', 24.00, N'已完成'),
    (202411002, 1022, 2005, '2024-11-01 08:30:00', 31.80, N'已完成'),
    (202411003, 1023, 2008, '2024-11-01 12:00:00', 65.00, N'已取餐'),
    (202411004, 1024, 2010, '2024-11-01 13:30:00', 16.00, N'已完成'),
    (202411005, 1025, 2002, '2024-11-01 17:45:00', 21.50, N'已完成'),
    (202411006, 1026, 2004, '2024-11-01 18:20:00', 45.00, N'已完成'),
    (202411007, 1027, 2009, '2024-11-01 19:15:00', 28.00, N'已取餐'),
    (202411008, 1028, 2013, '2024-11-01 20:00:00', 20.00, N'待支付'),
    (202411009, 1029, 2001, '2024-11-02 07:45:00', 19.00, N'已完成'),
    (202411010, 1030, 2003, '2024-11-02 12:30:00', 23.50, N'已完成'),

    -- 更多11月订单
    (202411011, 1031, 2006, '2024-11-03 08:00:00', 26.00, N'已完成'),
    (202411012, 1032, 2008, '2024-11-03 12:15:00', 58.00, N'已取餐'),
    (202411013, 1033, 2010, '2024-11-03 14:45:00', 12.00, N'已完成'),
    (202411014, 1034, 2001, '2024-11-03 18:00:00', 28.50, N'已完成'),
    (202411015, 1035, 2004, '2024-11-03 19:30:00', 40.00, N'已完成'),
    (202411016, 1036, 2009, '2024-11-04 07:30:00', 18.00, N'已完成'),
    (202411017, 1037, 2002, '2024-11-04 11:45:00', 22.00, N'已取餐'),
    (202411018, 1038, 2005, '2024-11-04 12:30:00', 34.80, N'已完成'),
    (202411019, 1039, 2010, '2024-11-04 16:00:00', 14.00, N'已完成'),
    (202411020, 1040, 2001, '2024-11-04 18:15:00', 26.00, N'已取餐'),

    -- 12月订单
    (202412001, 1041, 2003, '2024-12-01 07:45:00', 21.50, N'已完成'),
    (202412002, 1042, 2008, '2024-12-01 12:00:00', 72.00, N'已取餐'),
    (202412003, 1043, 2010, '2024-12-01 13:15:00', 16.00, N'已完成'),
    (202412004, 1044, 2004, '2024-12-01 18:30:00', 48.00, N'已完成'),
    (202412005, 1045, 2009, '2024-12-01 19:45:00', 32.00, N'已完成'),
    (202412006, 1046, 2001, '2024-12-02 08:00:00', 20.00, N'已完成'),
    (202412007, 1047, 2006, '2024-12-02 12:15:00', 30.00, N'已取餐'),
    (202412008, 1048, 2013, '2024-12-02 14:30:00', 25.00, N'已完成'),
    (202412009, 1049, 2002, '2024-12-02 17:30:00', 19.50, N'已完成'),
    (202412010, 1050, 2005, '2024-12-02 19:00:00', 38.80, N'已完成');

-- 5. 插入订单详情数据 (68条记录) - 修复外键约束问题
INSERT INTO OrderDetail
    (OrderID, DishID, Quantity, Subtotal)
VALUES
    -- 订单202410001的详情
    (202410001, 3001, 1, 18.00),
    -- 红烧肉
    (202410001, 3008, 2, 4.00),
    -- 白米饭
    (202410001, 3009, 1, 6.00),
    -- 紫菜蛋花汤

    -- 订单202410002的详情
    (202410002, 3021, 1, 18.00),
    -- 黄焖鸡米饭
    (202410002, 3018, 1, 3.00),
    -- 豆浆

    -- 订单202410003的详情
    (202410003, 3041, 1, 16.00),
    -- 红烧狮子头
    (202410003, 3045, 1, 26.00),
    -- 清蒸鲈鱼
    (202410003, 3046, 1, 8.00),
    -- 蚝油生菜

    -- 订单202410004的详情
    (202410004, 3061, 1, 45.00),
    -- 牛排
    (202410004, 3067, 1, 12.00),
    -- 薯条
    (202410004, 3069, 1, 15.00),
    -- 咖啡

    -- 订单202410005的详情
    (202410005, 3082, 1, 12.00),
    -- 珍珠奶茶

    -- 订单202410006的详情
    (202410006, 3002, 1, 16.00),
    -- 宫保鸡丁
    (202410006, 3005, 1, 20.00),
    -- 糖醋排骨
    (202410006, 3008, 1, 2.00),
    -- 白米饭
    (202410006, 3007, 1, 8.00),
    -- 炒青菜

    -- 订单202410007的详情
    (202410007, 3031, 1, 25.00),
    -- 麻辣香锅
    (202410007, 3036, 1, 18.00),
    -- 口水鸡

    -- 订单202410008的详情
    (202410008, 3071, 1, 12.00),
    -- 章鱼小丸子
    (202410008, 3077, 2, 12.00),
    -- 烤肠

    -- 订单202410009的详情
    (202410009, 3106, 1, 20.00),
    -- 麻辣烫套餐

    -- 订单202410010的详情
    (202410010, 3011, 1, 15.00),
    -- 鱼香肉丝
    (202410010, 3016, 1, 8.00),
    -- 蒸蛋羹
    (202410010, 3018, 1, 3.00),
    -- 豆浆

    -- 更多订单详情...
    -- 订单202410011的详情
    (202410011, 3003, 1, 12.00),
    -- 麻婆豆腐
    (202410011, 3004, 1, 14.00),
    -- 青椒肉丝
    (202410011, 3008, 2, 4.00),
    -- 白米饭

    -- 订单202410012的详情
    (202410012, 3022, 1, 16.00),
    -- 咖喱鸡饭
    (202410012, 3019, 1, 2.50),
    -- 油条

    -- 订单202410013的详情
    (202410013, 3051, 1, 22.00),
    -- 大盘鸡
    (202410013, 3058, 1, 6.00),
    -- 酸奶

    -- 订单202410014的详情
    (202410014, 3062, 1, 28.00),
    -- 意大利面
    (202410014, 3064, 1, 18.00),
    -- 沙拉
    (202410014, 3070, 1, 10.00),
    -- 果汁

    -- 订单202410015的详情
    (202410015, 3085, 1, 14.00),
    -- 芒果奶茶

    -- 订单202410016的详情
    (202410016, 3002, 1, 16.00),
    -- 宫保鸡丁
    (202410016, 3001, 1, 18.00),
    -- 红烧肉
    (202410016, 3008, 2, 4.00),
    -- 白米饭
    (202410016, 3010, 2, 8.00),
    -- 酸梅汤

    -- 订单202410017的详情
    (202410017, 3032, 1, 30.00),
    -- 火锅
    (202410017, 3037, 1, 16.00),
    -- 夫妻肺片

    -- 订单202410018的详情
    (202410018, 3072, 1, 10.00),
    -- 烤冷面
    (202410018, 3078, 1, 8.00),
    -- 玉米汁

    -- 订单202410019的详情
    (202410019, 3091, 1, 13.00),
    -- 兰州拉面
    (202410019, 3098, 1, 10.00),
    -- 红油抄手

    -- 订单202410020的详情
    (202410020, 3012, 1, 17.00),
    -- 回锅肉
    (202410020, 3015, 1, 9.00),
    -- 蒜蓉生菜
    (202410020, 3008, 1, 2.00),
    -- 白米饭

    -- 继续为更多订单生成详情数据...
    -- 11月订单详情
    (202411001, 3006, 1, 10.00),
    -- 西红柿鸡蛋
    (202411001, 3004, 1, 14.00),
    -- 青椒肉丝
    (202411001, 3008, 2, 4.00),
    -- 白米饭

    (202411002, 3042, 1, 15.00),
    -- 糖醋里脊
    (202411002, 3049, 1, 14.00),
    -- 煲仔饭
    (202411002, 3050, 1, 12.00),
    -- 老火靓汤

    (202411003, 3063, 1, 32.00),
    -- 披萨
    (202411003, 3065, 1, 15.00),
    -- 三明治
    (202411003, 3068, 1, 18.00),
    -- 炸鸡

    (202411004, 3086, 1, 14.00),
    -- 草莓奶茶
    (202411004, 3081, 1, 10.00),
    -- 原味奶茶

    (202411005, 3013, 1, 22.00),
    -- 水煮鱼
    (202411005, 3014, 1, 11.00),
    -- 干煸豆角
    (202411005, 3008, 1, 2.00),
    -- 白米饭

    (202411006, 3033, 1, 28.00),
    -- 烤鱼
    (202411006, 3035, 1, 22.00),
    -- 毛血旺

    (202411007, 3074, 1, 15.00),
    -- 铁板鱿鱼
    (202411007, 3075, 1, 14.00),
    -- 炸鸡排
    (202411007, 3079, 1, 7.00),
    -- 甘蔗汁

    (202411008, 3107, 1, 15.00),
    -- 素食麻辣烫
    (202411008, 3089, 1, 9.00),
    -- 乌龙茶

    (202411009, 3003, 1, 12.00),
    -- 麻婆豆腐
    (202411009, 3006, 1, 10.00),
    -- 西红柿鸡蛋
    (202411009, 3008, 2, 4.00),
    -- 白米饭

    (202411010, 3024, 1, 14.00),
    -- 扬州炒饭
    (202411010, 3029, 1, 15.00),
-- 牛肉面

    -- 订单202412001的详情
    (202412001, 3024, 1, 14.00),
    -- 扬州炒饭
    (202412001, 3029, 1, 7.50),
    -- 牛肉面（半份优惠）

    -- 订单202412002的详情
    (202412002, 3061, 1, 45.00),
    -- 牛排
    (202412002, 3065, 1, 15.00),
    -- 三明治
    (202412002, 3067, 1, 12.00),
    -- 薯条

    -- 订单202412003的详情
    (202412003, 3087, 1, 8.00),
    -- 绿茶
    (202412003, 3088, 1, 8.00),
    -- 红茶

    -- 订单202412004的详情
    (202412004, 3032, 1, 30.00),
    -- 火锅
    (202412004, 3036, 1, 18.00),
    -- 口水鸡

    -- 订单202412005的详情
    (202412005, 3074, 1, 15.00),
    -- 铁板鱿鱼
    (202412005, 3072, 1, 10.00),
    -- 烤冷面
    (202412005, 3079, 1, 7.00),
    -- 甘蔗汁

    -- 订单202412006的详情
    (202412006, 3001, 1, 18.00),
    -- 红烧肉
    (202412006, 3008, 1, 2.00),
    -- 白米饭

    -- 订单202412007的详情
    (202412007, 3051, 1, 22.00),
    -- 大盘鸡
    (202412007, 3055, 1, 2.00),
    -- 馕
    (202412007, 3058, 1, 6.00),
    -- 酸奶

    -- 订单202412008的详情
    (202412008, 3108, 1, 25.00),
    -- 蔬菜麻辣烫

    -- 订单202412009的详情
    (202412009, 3012, 1, 17.00),
    -- 回锅肉
    (202412009, 3019, 1, 2.50),
    -- 油条

    -- 订单202412010的详情
    (202412010, 3043, 1, 18.00),
    -- 白切鸡
    (202412010, 3049, 1, 14.00),
    -- 煲仔饭
    (202412010, 3046, 1, 6.80);
-- 蚝油生菜（会员折扣）

-- 6. 插入支付方式数据 (49条记录) - 修复支付方式约束问题
INSERT INTO PaymentMethod
    (OrderID, PayMethod, Amount, PayTime)
VALUES
    -- 2024年10月订单的支付记录
    (202410001, N'校园卡', 22.00, '2024-10-28 07:32:00'),
    (202410002, N'微信', 19.50, '2024-10-28 08:17:00'),
    (202410003, N'支付宝', 35.80, '2024-10-28 12:02:00'),
    (202410004, N'微信', 48.00, '2024-10-28 12:32:00'),
    (202410005, N'支付宝', 12.00, '2024-10-28 14:22:00'),
    (202410006, N'校园卡', 26.50, '2024-10-28 18:02:00'),
    (202410007, N'微信', 42.00, '2024-10-28 18:47:00'),
    (202410008, N'支付宝', 18.00, '2024-10-28 19:32:00'),
    (202410009, N'现金', 24.00, '2024-10-28 20:17:00'),
    (202410010, N'校园卡', 15.80, '2024-10-29 07:47:00'),

    -- 继续支付记录
    (202410011, N'微信', 20.00, '2024-10-29 08:02:00'),
    (202410012, N'支付宝', 17.50, '2024-10-29 11:47:00'),
    (202410013, N'校园卡', 28.00, '2024-10-29 12:17:00'),
    (202410014, N'微信', 52.00, '2024-10-29 12:47:00'),
    (202410015, N'支付宝', 14.00, '2024-10-29 15:32:00'),
    (202410016, N'校园卡', 32.50, '2024-10-29 17:47:00'),
    (202410017, N'微信', 38.00, '2024-10-29 18:32:00'),
    (202410018, N'支付宝', 22.00, '2024-10-29 19:02:00'),
    (202410019, N'现金', 16.00, '2024-10-29 19:47:00'),
    (202410020, N'校园卡', 18.50, '2024-10-30 07:32:00'),

    -- 11月支付记录
    (202411001, N'微信', 24.00, '2024-11-01 07:17:00'),
    (202411002, N'支付宝', 31.80, '2024-11-01 08:32:00'),
    (202411003, N'校园卡', 65.00, '2024-11-01 12:02:00'),
    (202411004, N'微信', 16.00, '2024-11-01 13:32:00'),
    (202411005, N'支付宝', 21.50, '2024-11-01 17:47:00'),
    (202411006, N'校园卡', 45.00, '2024-11-01 18:22:00'),
    (202411007, N'微信', 28.00, '2024-11-01 19:17:00'),
    -- 202411008为待支付状态，暂无支付记录
    (202411009, N'支付宝', 19.00, '2024-11-02 07:47:00'),
    (202411010, N'校园卡', 23.50, '2024-11-02 12:32:00'),

    -- 更多支付记录...
    (202411011, N'微信', 26.00, '2024-11-03 08:02:00'),
    (202411012, N'支付宝', 58.00, '2024-11-03 12:17:00'),
    (202411013, N'校园卡', 12.00, '2024-11-03 14:47:00'),
    (202411014, N'微信', 28.50, '2024-11-03 18:02:00'),
    (202411015, N'支付宝', 40.00, '2024-11-03 19:32:00'),
    (202411016, N'现金', 18.00, '2024-11-04 07:32:00'),
    (202411017, N'校园卡', 22.00, '2024-11-04 11:47:00'),
    (202411018, N'微信', 34.80, '2024-11-04 12:32:00'),
    (202411019, N'支付宝', 14.00, '2024-11-04 16:02:00'),
    (202411020, N'校园卡', 26.00, '2024-11-04 18:17:00'),

    -- 12月支付记录
    (202412001, N'微信', 21.50, '2024-12-01 07:47:00'),
    (202412002, N'支付宝', 72.00, '2024-12-01 12:02:00'),
    (202412003, N'校园卡', 16.00, '2024-12-01 13:17:00'),
    (202412004, N'微信', 48.00, '2024-12-01 18:32:00'),
    (202412005, N'支付宝', 32.00, '2024-12-01 19:47:00'),
    (202412006, N'现金', 20.00, '2024-12-02 08:02:00'),
    (202412007, N'校园卡', 30.00, '2024-12-02 12:17:00'),
    (202412008, N'微信', 25.00, '2024-12-02 14:32:00'),
    (202412009, N'支付宝', 19.50, '2024-12-02 17:32:00');
-- 202412010为已支付状态，暂不产生支付记录

-- 7. 插入积分记录数据 (41条记录) - 修复外键约束问题
INSERT INTO PointRecord
    (StudentID, OrderID, Points, CreatedAt)
VALUES
    -- 2024年10月订单的积分记录
    (1001, 202410001, 22, '2024-10-28 07:35:00'),
    -- 22.00元，积分22点
    (1002, 202410002, 20, '2024-10-28 08:20:00'),
    -- 19.50元，积分20点
    (1003, 202410003, 36, '2024-10-28 12:05:00'),
    -- 35.80元，积分36点
    (1004, 202410004, 48, '2024-10-28 12:35:00'),
    -- 48.00元，积分48点
    (1005, 202410005, 12, '2024-10-28 14:25:00'),
    -- 12.00元，积分12点
    (1006, 202410006, 27, '2024-10-28 18:05:00'),
    -- 26.50元，积分27点
    (1007, 202410007, 42, '2024-10-28 18:50:00'),
    -- 42.00元，积分42点
    (1008, 202410008, 18, '2024-10-28 19:35:00'),
    -- 18.00元，积分18点
    (1009, 202410009, 24, '2024-10-28 20:20:00'),
    -- 24.00元，积分24点
    (1010, 202410010, 16, '2024-10-29 07:50:00'),
    -- 15.80元，积分16点

    -- 继续积分记录
    (1011, 202410011, 20, '2024-10-29 08:05:00'),
    -- 20.00元，积分20点
    (1012, 202410012, 18, '2024-10-29 11:50:00'),
    -- 17.50元，积分18点
    (1013, 202410013, 28, '2024-10-29 12:20:00'),
    -- 28.00元，积分28点
    (1014, 202410014, 52, '2024-10-29 12:50:00'),
    -- 52.00元，积分52点
    (1015, 202410015, 14, '2024-10-29 15:35:00'),
    -- 14.00元，积分14点
    (1016, 202410016, 33, '2024-10-29 17:50:00'),
    -- 32.50元，积分33点
    (1017, 202410017, 38, '2024-10-29 18:35:00'),
    -- 38.00元，积分38点
    (1018, 202410018, 22, '2024-10-29 19:05:00'),
    -- 22.00元，积分22点
    (1019, 202410019, 16, '2024-10-29 19:50:00'),
    -- 16.00元，积分16点
    (1020, 202410020, 19, '2024-10-30 07:35:00'),
    -- 18.50元，积分19点

    -- 11月积分记录
    (1021, 202411001, 24, '2024-11-01 07:20:00'),
    -- 24.00元，积分24点
    (1022, 202411002, 32, '2024-11-01 08:35:00'),
    -- 31.80元，积分32点
    (1023, 202411003, 65, '2024-11-01 12:05:00'),
    -- 65.00元，积分65点
    (1024, 202411004, 16, '2024-11-01 13:35:00'),
    -- 16.00元，积分16点
    (1025, 202411005, 22, '2024-11-01 17:50:00'),
    -- 21.50元，积分22点
    (1026, 202411006, 45, '2024-11-01 18:25:00'),
    -- 45.00元，积分45点
    (1027, 202411007, 28, '2024-11-01 19:20:00'),
    -- 28.00元，积分28点
    -- 202411008为待支付状态，暂不产生积分
    (1029, 202411009, 19, '2024-11-02 07:50:00'),
    -- 19.00元，积分19点
    (1030, 202411010, 24, '2024-11-02 12:35:00'),
    -- 23.50元，积分24点

    -- 更多积分记录...
    (1031, 202411011, 26, '2024-11-03 08:05:00'),
    -- 26.00元，积分26点
    (1032, 202411012, 58, '2024-11-03 12:20:00'),
    -- 58.00元，积分58点
    (1033, 202411013, 12, '2024-11-03 14:50:00'),
    -- 12.00元，积分12点
    (1034, 202411014, 29, '2024-11-03 18:05:00'),
    -- 28.50元，积分29点
    (1035, 202411015, 40, '2024-11-03 19:35:00'),
    -- 40.00元，积分40点
    (1036, 202411016, 18, '2024-11-04 07:35:00'),
    -- 18.00元，积分18点
    (1037, 202411017, 22, '2024-11-04 11:50:00'),
    -- 22.00元，积分22点
    (1038, 202411018, 35, '2024-11-04 12:35:00'),
    -- 34.80元，积分35点
    (1039, 202411019, 14, '2024-11-04 16:05:00'),
    -- 14.00元，积分14点
    (1040, 202411020, 26, '2024-11-04 18:20:00'),
    -- 26.00元，积分26点

    -- 12月积分记录
    (1041, 202412001, 22, '2024-12-01 07:50:00'),
    -- 21.50元，积分22点
    (1042, 202412002, 72, '2024-12-01 12:05:00'),
    -- 72.00元，积分72点
    (1043, 202412003, 16, '2024-12-01 13:20:00'),
    -- 16.00元，积分16点
    (1044, 202412004, 48, '2024-12-01 18:35:00'),
    -- 48.00元，积分48点
    (1045, 202412005, 32, '2024-12-01 19:50:00'),
    -- 32.00元，积分32点
    (1046, 202412006, 20, '2024-12-02 08:05:00'),
    -- 20.00元，积分20点
    (1047, 202412007, 30, '2024-12-02 12:20:00'),
    -- 30.00元，积分30点
    (1048, 202412008, 25, '2024-12-02 14:35:00'),
    -- 25.00元，积分25点
    (1049, 202412009, 20, '2024-12-02 17:35:00'),
    -- 19.50元，积分20点
    (1050, 202412010, 39, '2024-12-02 19:05:00');
    -- 38.80元，积分39点

-- 8. 规范化与约束一致性处理（根据 init.sql 表结构）
-- 8.1 校准订单总额为订单详情小计之和
UPDATE o
SET o.TotalAmount = d.Total
FROM [Order] AS o
    JOIN (
  SELECT od.OrderID, SUM(od.Subtotal) AS Total
    FROM OrderDetail AS od
    GROUP BY od.OrderID
) AS d ON d.OrderID = o.OrderID;

-- 8.2 为已完成/已取餐/已支付的订单补齐支付记录（若不存在）
INSERT INTO PaymentMethod
    (OrderID, PayMethod, Amount, PayTime)
SELECT o.OrderID, N'微信', o.TotalAmount, o.OrderTime
FROM [Order] AS o
WHERE o.Status IN (N'已完成', N'已取餐', N'已支付')
    AND NOT EXISTS (
    SELECT 1
    FROM PaymentMethod AS pm
    WHERE pm.OrderID = o.OrderID
  );

-- 8.3 为已完成/已取餐/已支付的订单补齐积分记录（若不存在）
INSERT INTO PointRecord
    (StudentID, OrderID, Points, CreatedAt)
SELECT o.StudentID, o.OrderID, CAST(o.TotalAmount * 10 AS INT), o.OrderTime
FROM [Order] AS o
WHERE o.Status IN (N'已完成', N'已取餐', N'已支付')
    AND NOT EXISTS (
    SELECT 1
    FROM PointRecord AS pr
    WHERE pr.OrderID = o.OrderID
  );

COMMIT;

-- 数据插入完成提示
SELECT N'所有修复后的示例数据插入完成！' AS message;
SELECT N'数据统计：' AS message;
SELECT N'- 学生记录：50条' AS message;
SELECT N'- 商家记录：20条' AS message;
SELECT N'- 菜品记录：153条' AS message;
SELECT N'- 订单记录：50条' AS message;
SELECT N'- 订单详情记录：68条' AS message;
SELECT N'- 支付记录：49条' AS message;
SELECT N'- 积分记录：41条' AS message;
